
{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User Profile",
      "type": "object",
      "description": "Represents a user's profile in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user (matches Auth UID)."
        },
        "name": {
          "type": "string",
          "description": "The user's display name."
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "The user's email address."
        },
        "role": {
          "type": "string",
          "description": "The name of the user's role."
        },
        "avatar": {
          "type": "string",
          "format": "uri",
          "description": "URL to the user's avatar image (optional)."
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "role"
      ]
    },
    "Role": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Role",
      "description": "Defines a user role and its page access permissions.",
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the role (usually the role name in lowercase)."
        },
        "name": {
          "type": "string",
          "description": "The display name of the role."
        },
        "allowedRoutes": {
          "type": "array",
          "description": "A list of application routes this role can access.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "allowedRoutes"
      ]
    },
    "Piece": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Piece",
      "type": "object",
      "description": "Represents a manufactured piece with its associated details.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Piece entity."
        },
        "codigo": {
          "type": "string",
          "description": "The piece's unique code."
        }
      },
      "required": [
        "id",
        "codigo"
      ]
    },
    "Mold": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Mold",
      "type": "object",
      "description": "Represents a mold used in the aluminum injection process.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Mold entity."
        },
        "nombre": {
          "type": "string",
          "description": "The name of the mold."
        },
        "pieces": {
          "type": "array",
          "description": "References to Pieces produced by this mold. (Relationship: Mold 1:N Piece)",
          "items": {
            "type": "string"
          }
        },
        "cavidades": {
          "type": "number",
          "description": "The number of cavities in the mold."
        },
        "compatibilidad": {
          "type": "array",
          "description": "The machines compatible with the mold.",
          "items": {
            "type": "string"
          }
        },
        "cicloBase_s": {
          "type": "number",
          "description": "The base cycle time in seconds for the mold."
        },
        "setupMin": {
          "type": "number",
          "description": "The minimum setup time for the mold."
        },
        "vidaMaxTiros": {
          "type": "number",
          "description": "The maximum number of shots allowed for the mold before maintenance."
        },
        "tiempoRecambioMin": {
          "type": "number",
          "description": "The minimum changeover time for the mold."
        },
        "status": {
          "type": "string",
          "description": "The status of the mold (ok or mantenimiento)."
        }
      },
      "required": [
        "id",
        "nombre",
        "pieces",
        "cavidades",
        "compatibilidad",
        "cicloBase_s",
        "setupMin",
        "vidaMaxTiros",
        "tiempoRecambioMin",
        "status"
      ]
    },
    "Machine": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Machine",
      "type": "object",
      "description": "Represents a machine used in the aluminum injection process.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Machine entity."
        },
        "nombre": {
          "type": "string",
          "description": "The name of the machine."
        },
        "tonelaje": {
          "type": "number",
          "description": "The tonnage of the machine."
        },
        "turnosSemana": {
          "type": "number",
          "description": "The number of shifts per week for the machine."
        },
        "horasTurno": {
          "type": "number",
          "description": "The number of hours per shift for the machine."
        },
        "OEE_obj": {
          "type": "number",
          "description": "The target Overall Equipment Effectiveness (OEE) for the machine."
        },
        "OEE_hist": {
          "type": "number",
          "description": "The historical Overall Equipment Effectiveness (OEE) for the machine (optional)."
        }
      },
      "required": [
        "id",
        "nombre",
        "tonelaje",
        "turnosSemana",
        "horasTurno",
        "OEE_obj"
      ]
    },
    "Demand": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Demand",
      "type": "object",
      "description": "Represents the demand for a specific piece in a specific period.",
      "properties": {
        "periodoYYYYWW": {
          "type": "string",
          "description": "The period in YYYYWW format."
        },
        "pieceId": {
          "type": "string",
          "description": "Reference to Piece. (Relationship: Demand 1:N Piece)"
        },
        "qty": {
          "type": "number",
          "description": "The quantity of demand."
        },
        "prioridad": {
          "type": "number",
          "description": "The priority of the demand (1, 2, or 3)."
        },
        "version": {
          "type": "number",
          "description": "The version of the demand."
        },
        "congelado": {
          "type": "boolean",
          "description": "Indicates whether the demand is frozen."
        }
      },
      "required": [
        "periodoYYYYWW",
        "pieceId",
        "qty",
        "prioridad",
        "version",
        "congelado"
      ]
    },
    "Inventory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Inventory",
      "type": "object",
      "description": "Represents the inventory level for a specific piece on a specific date.",
      "properties": {
        "pieceId": {
          "type": "string",
          "description": "Reference to Piece. (Relationship: Inventory 1:N Piece)"
        },
        "fechaISO": {
          "type": "string",
          "description": "The date in ISO format."
        },
        "stock": {
          "type": "number",
          "description": "The stock level."
        }
      },
      "required": [
        "pieceId",
        "fechaISO",
        "stock"
      ]
    },
    "Calendar": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Calendar",
      "type": "object",
      "description": "Represents the calendar events for a specific machine in a specific period.",
      "properties": {
        "machineId": {
          "type": "string",
          "description": "Reference to Machine. (Relationship: Calendar 1:N Machine)"
        },
        "periodoYYYYWW": {
          "type": "string",
          "description": "The period in YYYYWW format."
        },
        "mantenimientoPlan": {
          "type": "array",
          "description": "Planned maintenance events.",
          "items": {
            "type": "number"
          }
        },
        "tryouts": {
          "type": "array",
          "description": "Tryout events.",
          "items": {
            "type": "number"
          }
        }
      },
      "required": [
        "machineId",
        "periodoYYYYWW",
        "mantenimientoPlan",
        "tryouts"
      ]
    },
    "Downtime": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Downtime",
      "type": "object",
      "description": "Represents the downtime events for a specific machine in a specific month.",
      "properties": {
        "machineId": {
          "type": "string",
          "description": "Reference to Machine. (Relationship: Downtime 1:N Machine)"
        },
        "YYYYMM": {
          "type": "string",
          "description": "The month in YYYYMM format."
        },
        "minutos": {
          "type": "number",
          "description": "The number of minutes of downtime."
        },
        "categoria": {
          "type": "string",
          "description": "The category of downtime."
        },
        "causa": {
          "type": "string",
          "description": "The cause of downtime (optional)."
        },
        "plan": {
          "type": "boolean",
          "description": "Indicates whether the downtime was planned."
        },
        "tryout": {
          "type": "boolean",
          "description": "Indicates whether the downtime was due to a tryout."
        }
      },
      "required": [
        "machineId",
        "YYYYMM",
        "minutos",
        "categoria",
        "plan",
        "tryout"
      ]
    },
    "DowntimeAgg": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DowntimeAgg",
      "type": "object",
      "description": "Represents the aggregated downtime data for a specific machine in a specific month.",
      "properties": {
        "machineId": {
          "type": "string",
          "description": "Reference to Machine. (Relationship: DowntimeAgg 1:N Machine)"
        },
        "YYYYMM": {
          "type": "string",
          "description": "The month in YYYYMM format."
        },
        "min_totales": {
          "type": "number",
          "description": "The total minutes of downtime."
        },
        "min_planificados": {
          "type": "number",
          "description": "The total minutes of planned downtime."
        },
        "min_no_plan": {
          "type": "number",
          "description": "The total minutes of unplanned downtime."
        },
        "min_tryout": {
          "type": "number",
          "description": "The total minutes of downtime due to tryouts."
        }
      },
      "required": [
        "machineId",
        "YYYYMM",
        "min_totales",
        "min_planificados",
        "min_no_plan",
        "min_tryout"
      ]
    },
    "Plan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Plan",
      "type": "object",
      "description": "Represents a production plan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Plan entity."
        },
        "createdAt": {
          "type": "string",
          "description": "The creation timestamp of the plan."
        },
        "params": {
          "type": "string",
          "description": "The parameters used to generate the plan."
        },
        "status": {
          "type": "string",
          "description": "The status of the plan (draft or published)."
        }
      },
      "required": [
        "id",
        "createdAt",
        "params",
        "status"
      ]
    },
    "Assignment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Assignment",
      "type": "object",
      "description": "Represents an assignment of a piece and mold to a machine for a specific week within a production plan.",
      "properties": {
        "planId": {
          "type": "string",
          "description": "Reference to Plan. (Relationship: Plan 1:N Assignment)"
        },
        "pieceId": {
          "type": "string",
          "description": "Reference to Piece. (Relationship: Assignment 1:N Piece)"
        },
        "moldId": {
          "type": "string",
          "description": "Reference to Mold. (Relationship: Assignment 1:N Mold)"
        },
        "machineId": {
          "type": "string",
          "description": "Reference to Machine. (Relationship: Assignment 1:N Machine)"
        },
        "semana": {
          "type": "string",
          "description": "The week in YYYYWW format."
        },
        "horas": {
          "type": "number",
          "description": "The number of hours assigned."
        },
        "setup": {
          "type": "boolean",
          "description": "Indicates whether a setup is required."
        },
        "prodUnidades": {
          "type": "number",
          "description": "The number of units produced."
        }
      },
      "required": [
        "planId",
        "pieceId",
        "moldId",
        "machineId",
        "semana",
        "horas",
        "setup",
        "prodUnidades"
      ]
    },
    "Production": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Production",
      "type": "object",
      "description": "Represents the actual production data for a specific date.",
      "properties": {
        "fechaISO": {
          "type": "string",
          "description": "The date in ISO format."
        },
        "machineId": {
          "type": "string",
          "description": "Reference to Machine. (Relationship: Production 1:N Machine)"
        },
        "pieceId": {
          "type": "string",
          "description": "Reference to Piece. (Relationship: Production 1:N Piece)"
        },
        "moldId": {
          "type": "string",
          "description": "Reference to Mold. (Relationship: Production 1:N Mold)"
        },
        "horas": {
          "type": "number",
          "description": "The number of hours of production."
        },
        "unidades": {
          "type": "number",
          "description": "The number of units produced."
        },
        "scrapPct": {
          "type": "number",
          "description": "The scrap percentage."
        }
      },
      "required": [
        "fechaISO",
        "machineId",
        "pieceId",
        "moldId",
        "horas",
        "unidades",
        "scrapPct"
      ]
    },
    "Setting": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Setting",
      "type": "object",
      "description": "Represents global settings for the application.",
      "properties": {
        "ventana_meses": {
          "type": "number",
          "description": "The window of months for downtime aggregation."
        },
        "suavizado_alpha": {
          "type": "number",
          "description": "The smoothing alpha value."
        },
        "cap_pct": {
          "type": "number",
          "description": "The cap percentage."
        },
        "minAvail": {
          "type": "number",
          "description": "The minimum availability."
        },
        "maxAvail": {
          "type": "number",
          "description": "The maximum availability."
        }
      },
      "required": [
        "ventana_meses",
        "suavizado_alpha",
        "cap_pct",
        "minAvail",
        "maxAvail"
      ]
    },
    "Client": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Client",
      "description": "Represents a client.",
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the client."
        },
        "nombre": {
          "type": "string",
          "description": "The name of the client."
        }
      },
      "required": [
        "id",
        "name"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user, matching Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "roles/{roleId}",
        "definition": {
          "entityName": "Role",
          "schema": {
            "$ref": "#/backend/entities/Role"
          },
          "description": "Stores application roles and their page access permissions.",
          "params": [
            {
              "name": "roleId",
              "description": "Unique identifier for the role."
            }
          ]
        }
      },
      {
        "path": "pieces/{pieceId}",
        "definition": {
          "entityName": "Piece",
          "schema": {
            "$ref": "#/backend/entities/Piece"
          },
          "description": "Stores details of manufactured pieces.",
          "params": [
            {
              "name": "pieceId",
              "description": "Unique identifier for the piece."
            }
          ]
        }
      },
      {
        "path": "molds/{moldId}",
        "definition": {
          "entityName": "Mold",
          "schema": {
            "$ref": "#/backend/entities/Mold"
          },
          "description": "Stores information about molds used in the aluminum injection process.",
          "params": [
            {
              "name": "moldId",
              "description": "Unique identifier for the mold."
            }
          ]
        }
      },
      {
        "path": "machines/{machineId}",
        "definition": {
          "entityName": "Machine",
          "schema": {
            "$ref": "#/backend/entities/Machine"
          },
          "description": "Stores details about machines used in production.",
          "params": [
            {
              "name": "machineId",
              "description": "Unique identifier for the machine."
            }
          ]
        }
      },
      {
        "path": "demand/{periodoYYYYWW}/{pieceId}",
        "definition": {
          "entityName": "Demand",
          "schema": {
            "$ref": "#/backend/entities/Demand"
          },
          "description": "Stores demand data for a specific piece in a specific period.",
          "params": [
            {
              "name": "periodoYYYYWW",
              "description": "The period in YYYYWW format."
            },
            {
              "name": "pieceId",
              "description": "Reference to Piece."
            }
          ]
        }
      },
      {
        "path": "inventory/{pieceId}/{fechaISO}",
        "definition": {
          "entityName": "Inventory",
          "schema": {
            "$ref": "#/backend/entities/Inventory"
          },
          "description": "Stores inventory levels for a specific piece on a specific date.",
          "params": [
            {
              "name": "pieceId",
              "description": "Reference to Piece."
            },
            {
              "name": "fechaISO",
              "description": "The date in ISO format."
            }
          ]
        }
      },
      {
        "path": "inventory/current/{pieceId}",
        "definition": {
          "entityName": "Inventory",
          "schema": {
            "$ref": "#/backend/entities/Inventory"
          },
          "description": "Stores the current inventory level for a specific piece.",
          "params": [
            {
              "name": "pieceId",
              "description": "Reference to Piece."
            }
          ]
        }
      },
      {
        "path": "calendars/{machineId}/{periodoYYYYWW}",
        "definition": {
          "entityName": "Calendar",
          "schema": {
            "$ref": "#/backend/entities/Calendar"
          },
          "description": "Stores calendar events for a specific machine in a specific period.",
          "params": [
            {
              "name": "machineId",
              "description": "Reference to Machine."
            },
            {
              "name": "periodoYYYYWW",
              "description": "The period in YYYYWW format."
            }
          ]
        }
      },
      {
        "path": "downtime/{machineId}/{YYYYMM}",
        "definition": {
          "entityName": "Downtime",
          "schema": {
            "$ref": "#/backend/entities/Downtime"
          },
          "description": "Stores downtime events for a specific machine in a specific month.",
          "params": [
            {
              "name": "machineId",
              "description": "Reference to Machine."
            },
            {
              "name": "YYYYMM",
              "description": "The month in YYYYMM format."
            }
          ]
        }
      },
      {
        "path": "downtime_agg/{machineId}/{YYYYMM}",
        "definition": {
          "entityName": "DowntimeAgg",
          "schema": {
            "$ref": "#/backend/entities/DowntimeAgg"
          },
          "description": "Stores aggregated downtime data for a specific machine in a specific month.",
          "params": [
            {
              "name": "machineId",
              "description": "Reference to Machine."
            },
            {
              "name": "YYYYMM",
              "description": "The month in YYYYMM format."
            }
          ]
        }
      },
      {
        "path": "plans/{planId}",
        "definition": {
          "entityName": "Plan",
          "schema": {
            "$ref": "#/backend/entities/Plan"
          },
          "description": "Stores production plans.",
          "params": [
            {
              "name": "planId",
              "description": "Unique identifier for the plan."
            }
          ]
        }
      },
      {
        "path": "plans/{planId}/assignments/{assignmentId}",
        "definition": {
          "entityName": "Assignment",
          "schema": {
            "$ref": "#/backend/entities/Assignment"
          },
          "description": "Stores assignments of pieces and molds to machines for a specific week within a production plan.",
          "params": [
            {
              "name": "planId",
              "description": "Reference to Plan."
            },
            {
              "name": "assignmentId",
              "description": "Unique identifier for the assignment."
            }
          ]
        }
      },
      {
        "path": "production/{fechaISO}",
        "definition": {
          "entityName": "Production",
          "schema": {
            "$ref": "#/backend/entities/Production"
          },
          "description": "Stores actual production data for a specific date.",
          "params": [
            {
              "name": "fechaISO",
              "description": "The date in ISO format."
            }
          ]
        }
      },
      {
        "path": "settings/global",
        "definition": {
          "entityName": "Setting",
          "schema": {
            "$ref": "#/backend/entities/Setting"
          },
          "description": "Stores global settings for the application."
        }
      },
      {
        "path": "clients/{clientId}",
        "definition": {
          "entityName": "Client",
          "schema": {
            "$ref": "#/backend/entities/Client"
          },
          "description": "Stores client information.",
          "params": [
            {
              "name": "clientId",
              "description": "Unique identifier for the client."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the ForgeFlow application's production planning and execution features. It prioritizes authorization independence and QAPs by denormalizing data where necessary and using structural segregation. Path-based ownership is used for user-specific data, and membership maps are avoided since there's no collaborative data in the application. The structure enables secure list operations by ensuring that each collection has a homogeneous security posture.\n\n**Authorization Independence:** Data such as the Machines, Molds and Pieces collections are global, so they don't need any explicit authorization besides roles. User-specific collections like Assignments are secured via path-based ownership.\n\n**QAPs:** List operations are secured by structural segregation. For instance, listing assignments is only allowed within a specific plan (plans/{planId}/assignments/{assignmentId}).  This prevents unauthorized listing of assignments across different plans."
  }
}
    