/**
 * @fileoverview Firestore Security Rules for ForgeFlow application.
 *
 * Core Philosophy:
 * This ruleset enforces a primarily public-read, owner-only-write model, supplemented by role-based access where applicable.
 *
 * Data Structure:
 * The Firestore database contains collections for pieces, molds, machines, demand, inventory, calendars, downtime, aggregated downtime, plans, assignments, production, and global settings.
 * - Global data (pieces, molds, machines, production, global settings) resides in top-level collections and is generally readable by all users.
 * - Plan and Assignments are nested collections.
 *
 * Key Security Decisions:
 * - Public Read, Restricted Write: Most top-level collections allow public read access but restrict write access based on ownership or roles.
 * - No User Listing: User listing is not supported or necessary in this application.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows read access to piece documents, but restricts write access.
     * @path /pieces/{pieceId}
     * @allow get, list: if true;
     * @allow create: if false;
     * @allow update: if false;
     * @allow delete: if false;
     * @principle Public read, restricted write.
     */
    match /pieces/{pieceId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows read access to mold documents, but restricts write access.
     * @path /molds/{moldId}
     * @allow get, list: if true;
     * @allow create: if false;
     * @allow update: if false;
     * @allow delete: if false;
     * @principle Public read, restricted write.
     */
    match /molds/{moldId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows read access to machine documents, but restricts write access.
     * @path /machines/{machineId}
     * @allow get, list: if true;
     * @allow create: if false;
     * @allow update: if false;
     * @allow delete: if false;
     * @principle Public read, restricted write.
     */
    match /machines/{machineId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows read access to demand documents, but restricts write access.
     * @path /demand/{periodoYYYYWW}/{pieceId}
     * @allow get, list: if true;
     * @allow create: if false;
     * @allow update: if false;
     * @allow delete: if false;
     * @principle Public read, restricted write.
     */
    match /demand/{periodoYYYYWW}/{pieceId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows read access to inventory documents, but restricts write access.
     * @path /inventory/{pieceId}/{fechaISO}
     * @allow get, list: if true;
     * @allow create: if false;
     * @allow update: if false;
     * @allow delete: if false;
     * @principle Public read, restricted write.
     */
    match /inventory/{pieceId}/{fechaISO} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

     /**
      * @description Allows read access to current inventory documents, but restricts write access.
      * @path /inventory/current/{pieceId}
      * @allow get, list: if true;
      * @allow create: if false;
      * @allow update: if false;
      * @allow delete: if false;
      * @principle Public read, restricted write.
      */
    match /inventory/current/{pieceId} {
        allow get, list: if true;
        allow create, update, delete: if false;
    }

    /**
     * @description Allows read access to calendar documents, but restricts write access.
     * @path /calendars/{machineId}/{periodoYYYYWW}
     * @allow get, list: if true;
     * @allow create: if false;
     * @allow update: if false;
     * @allow delete: if false;
     * @principle Public read, restricted write.
     */
    match /calendars/{machineId}/{periodoYYYYWW} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows read access to downtime documents, but restricts write access.
     * @path /downtime/{machineId}/{YYYYMM}
     * @allow get, list: if true;
     * @allow create: if false;
     * @allow update: if false;
     * @allow delete: if false;
     * @principle Public read, restricted write.
     */
    match /downtime/{machineId}/{YYYYMM} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows read access to aggregated downtime documents, but restricts write access.
     * @path /downtime_agg/{machineId}/{YYYYMM}
     * @allow get, list: if true;
     * @allow create: if false;
     * @allow update: if false;
     * @allow delete: if false;
     * @principle Public read, restricted write.
     */
    match /downtime_agg/{machineId}/{YYYYMM} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows read access to plan documents, but restricts write access.
     * @path /plans/{planId}
     * @allow get, list: if true;
     * @allow create: if false;
     * @allow update: if false;
     * @allow delete: if false;
     * @principle Public read, restricted write.
     */
    match /plans/{planId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows read access to assignment documents within a plan, but restricts write access.
     * @path /plans/{planId}/assignments/{assignmentId}
     * @allow get, list: if true;
     * @allow create: if false;
     * @allow update: if false;
     * @allow delete: if false;
     * @principle Public read, restricted write.
     */
    match /plans/{planId}/assignments/{assignmentId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows read access to production documents, but restricts write access.
     * @path /production/{fechaISO}
     * @allow get, list: if true;
     * @allow create: if false;
     * @allow update: if false;
     * @allow delete: if false;
     * @principle Public read, restricted write.
     */
    match /production/{fechaISO} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows read access to global settings, but restricts write access.
     * @path /settings/global
     * @allow get: if true;
     * @allow list: if false;
     * @allow create: if false;
     * @allow update: if false;
     * @allow delete: if false;
     * @principle Public read, restricted write.
     */
    match /settings/global {
      allow get: if true;
      allow list: if false;
      allow create, update, delete: if false;
    }
  }
}