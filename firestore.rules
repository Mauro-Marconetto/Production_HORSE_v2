/**
 * @fileoverview Firestore Security Rules for ForgeFlow application.
 *
 * Core Philosophy:
 * This ruleset enforces a role-based access control model.
 * Data is organized into global collections for Pieces, Molds, Machines, and Settings, and plan-specific subcollections for Assignments.
 * The primary goal is to prevent unauthorized data access and modification, especially for sensitive production planning information.
 *
 * Data Structure:
 * - /pieces/{pieceId}: Stores information about manufactured pieces.
 * - /molds/{moldId}: Stores information about molds.
 * - /machines/{machineId}: Stores information about machines.
 * - /demand/{periodoYYYYWW}/{pieceId}: Stores demand data for a specific piece in a specific period.
 * - /inventory/{pieceId}/{fechaISO}: Stores inventory levels for a specific piece on a specific date.
 * - /inventory/current/{pieceId}: Stores the current inventory level for a specific piece.
 * - /calendars/{machineId}/{periodoYYYYWW}: Stores calendar events for a specific machine in a specific period.
 * - /downtime/{machineId}/{YYYYMM}: Stores downtime events for a specific machine in a specific month.
 * - /downtime_agg/{machineId}/{YYYYMM}: Stores aggregated downtime data for a specific machine in a specific month.
 * - /plans/{planId}: Stores production plans.
 * - /plans/{planId}/assignments/{assignmentId}: Stores assignments of pieces and molds to machines for a specific week.
 * - /production/{fechaISO}: Stores actual production data for a specific date.
 * - /settings/global: Stores global settings for the application.
 *
 * Key Security Decisions:
 * - Global collections (pieces, molds, machines, settings) are publicly readable.
 * - Write access to global collections is denied to all users.
 * - Assignments are secured to plan-specific access.
 * - List operations are generally allowed where reading documents is allowed.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Controls access to Piece documents.
     * @path /pieces/{pieceId}
     * @allow (get, list): Always allowed.
     * @deny (create, update, delete): Always denied.
     * @principle Public read, owner-only writes (not applicable as there is no owner and writes are disallowed).
     */
    match /pieces/{pieceId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Controls access to Mold documents.
     * @path /molds/{moldId}
     * @allow (get, list): Always allowed.
     * @deny (create, update, delete): Always denied.
     * @principle Public read, owner-only writes (not applicable as there is no owner and writes are disallowed).
     */
    match /molds/{moldId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Controls access to Machine documents.
     * @path /machines/{machineId}
     * @allow (get, list): Always allowed.
     * @deny (create, update, delete): Always denied.
     * @principle Public read, owner-only writes (not applicable as there is no owner and writes are disallowed).
     */
    match /machines/{machineId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Controls access to Demand documents.
     * @path /demand/{periodoYYYYWW}/{pieceId}
     * @allow (get, list): Always allowed.
     * @deny (create, update, delete): Always denied.
     * @principle Public read, owner-only writes (not applicable as there is no owner and writes are disallowed).
     */
    match /demand/{periodoYYYYWW}/{pieceId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Controls access to Inventory documents.
     * @path /inventory/{pieceId}/{fechaISO}
     * @allow (get, list): Always allowed.
     * @deny (create, update, delete): Always denied.
     * @principle Public read, owner-only writes (not applicable as there is no owner and writes are disallowed).
     */
    match /inventory/{pieceId}/{fechaISO} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

      /**
       * @description Controls access to current Inventory documents.
       * @path /inventory/current/{pieceId}
       * @allow (get, list): Always allowed.
       * @deny (create, update, delete): Always denied.
       * @principle Public read, owner-only writes (not applicable as there is no owner and writes are disallowed).
       */
    match /inventory/current/{pieceId} {
        allow get, list: if true;
        allow create, update, delete: if false;
      }

    /**
     * @description Controls access to Calendar documents.
     * @path /calendars/{machineId}/{periodoYYYYWW}
     * @allow (get, list): Always allowed.
     * @deny (create, update, delete): Always denied.
     * @principle Public read, owner-only writes (not applicable as there is no owner and writes are disallowed).
     */
    match /calendars/{machineId}/{periodoYYYYWW} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Controls access to Downtime documents.
     * @path /downtime/{machineId}/{YYYYMM}
     * @allow (get, list): Always allowed.
     * @deny (create, update, delete): Always denied.
     * @principle Public read, owner-only writes (not applicable as there is no owner and writes are disallowed).
     */
    match /downtime/{machineId}/{YYYYMM} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Controls access to DowntimeAgg documents.
     * @path /downtime_agg/{machineId}/{YYYYMM}
     * @allow (get, list): Always allowed.
     * @deny (create, update, delete): Always denied.
     * @principle Public read, owner-only writes (not applicable as there is no owner and writes are disallowed).
     */
    match /downtime_agg/{machineId}/{YYYYMM} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Controls access to Plan documents.
     * @path /plans/{planId}
     * @allow (get, list): Always allowed.
     * @deny (create, update, delete): Always denied.
     * @principle Public read, owner-only writes (not applicable as there is no owner and writes are disallowed).
     */
    match /plans/{planId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Controls access to Assignment documents within a specific plan.
     * @path /plans/{planId}/assignments/{assignmentId}
     * @allow (get, list): Always allowed.
     * @deny (create, update, delete): Always denied.
     * @principle Plan-specific access control.
     */
    match /plans/{planId}/assignments/{assignmentId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Controls access to Production documents.
     * @path /production/{fechaISO}
     * @allow (get, list): Always allowed.
     * @deny (create, update, delete): Always denied.
     * @principle Public read, owner-only writes (not applicable as there is no owner and writes are disallowed).
     */
    match /production/{fechaISO} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Controls access to the global Setting document.
     * @path /settings/global
     * @allow (get, list): Always allowed.
     * @deny (create, update, delete): Always denied.
     * @principle Public read, owner-only writes (not applicable as there is no owner and writes are disallowed).
     */
    match /settings/global {
      allow get, list: if true;
      allow create, update, delete: if false;
    }
  }
}